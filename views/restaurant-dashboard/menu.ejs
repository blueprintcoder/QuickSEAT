<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Menu Management - QuickSEAT</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
    
    <style>
      /* ========================================================= */
      /* EXACT STYLES FROM DASHBOARD/EDIT (Layout & Sidebar)      */
      /* ========================================================= */
      
      /* BASE LAYOUT */
      body, html {
        margin: 0;
        padding: 0;
        height: 100vh;
        font-family: "Inter", sans-serif;
        background-color: #f4f7f9;
      }
      
      .dashboard-layout {
        display: flex;
        height: 100%;
      }

      /* SIDEBAR STYLING */
      .sidebar {
        width: 250px;
        background-color: #34495e;
        color: white;
        display: flex;
        flex-direction: column;
        padding: 20px 0;
        box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
        flex-shrink: 0;
      }

      .sidebar .logo {
        font-size: 1.8rem;
        font-weight: bold;
        padding: 0 20px 20px;
        border-bottom: 1px solid #4a637d;
        margin-bottom: 20px;
      }

      .sidebar nav ul {
        list-style: none;
        padding: 0;
        margin: 0;
      }

      .sidebar nav ul li a {
        display: flex;
        align-items: center;
        gap: 15px;
        padding: 12px 20px;
        color: white;
        text-decoration: none;
        font-size: 1rem;
        transition: background-color 0.2s;
      }

      .sidebar nav ul li a:hover,
      .sidebar nav ul li.active a {
        background-color: #4a637d;
      }

      .sidebar .logout-area {
        margin-top: auto;
        padding: 20px;
      }

      .sidebar .btn-customer-site,
      .sidebar .btn-logout {
        width: 100%;
        padding: 10px;
        border-radius: 8px;
        margin-top: 10px;
        cursor: pointer;
        font-weight: 600;
        text-align: center;
        text-decoration: none;
        color: white;
        transition: background-color 0.2s;
        border: none;
        display: block;
        box-sizing: border-box;
      }
      
      .sidebar .btn-customer-site {
          background-color: #3498db;
      }
      
      .sidebar .btn-logout {
          background-color: #e74c3c;
      }

      /* MAIN CONTENT AREA */
      .main-content {
        flex-grow: 1;
        padding: 30px;
        overflow-y: auto;
      }

      /* ========================================================= */
      /* MENU PAGE SPECIFIC STYLES                                */
      /* ========================================================= */
      .dashboard-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 30px;
      }

      .dashboard-header h1 {
          color: #34495e;
          margin: 0;
      }

      .user-profile {
          display: flex;
          align-items: center;
          gap: 10px;
          background-color: white;
          padding: 8px 15px;
          border-radius: 20px;
          box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      }

      .alert {
          padding: 15px;
          border-radius: 6px;
          margin-bottom: 20px;
          font-weight: 500;
      }
      .alert-success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
      .alert-error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }

      .form-wrapper {
          background: white;
          padding: 25px;
          border-radius: 12px;
          box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
          margin-bottom: 30px;
      }

      .form-wrapper h2 {
          color: #2c3e50;
          margin-bottom: 20px;
          border-bottom: 2px solid #f4f7f9;
          padding-bottom: 10px;
      }

      .form-row {
          display: grid;
          grid-template-columns: 1fr 1fr;
          gap: 20px;
          margin-bottom: 15px;
      }

      .form-group {
          margin-bottom: 15px;
      }

      .form-group label {
          display: block;
          margin-bottom: 8px;
          font-weight: 600;
          color: #34495e;
      }

      .form-group input[type="text"],
      .form-group input[type="number"],
      .form-group input[type="file"],
      .form-group textarea {
          width: 100%;
          padding: 10px;
          border: 1px solid #ddd;
          border-radius: 6px;
          font-size: 1rem;
          box-sizing: border-box;
      }

      .form-group textarea { resize: vertical; }

      .btn-primary {
          background-color: #2ecc71;
          color: white;
          padding: 12px 24px;
          border: none;
          border-radius: 6px;
          cursor: pointer;
          font-weight: 600;
          font-size: 1rem;
      }
      .btn-primary:hover { background-color: #27ae60; }

      /* Menu Grid Styles */
      .stats-grid {
          display: grid;
          grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
          gap: 20px;
      }

      .stat-card {
          background: white;
          border: 1px solid #eee;
          border-radius: 8px;
          padding: 15px;
          display: flex;
          gap: 15px;
          align-items: flex-start;
          transition: transform 0.2s;
      }
      
      .stat-card:hover {
          transform: translateY(-2px);
          box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      }

      .stat-icon {
          width: 80px;
          height: 80px;
          border-radius: 8px;
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 2rem;
          color: white;
          flex-shrink: 0;
      }

      .stat-details {
          flex-grow: 1;
      }

      .stat-details h3 {
          margin: 0 0 5px 0;
          color: #2c3e50;
          font-size: 1.1rem;
      }

      .stat-details p {
          margin: 0 0 5px 0;
          color: #7f8c8d;
          font-size: 0.9rem;
      }

      .actions {
          margin-top: 10px;
          display: flex;
          gap: 8px;
      }

      .btn-small {
          padding: 6px 12px;
          font-size: 0.8rem;
          border-radius: 4px;
          text-decoration: none;
          color: white;
      }

      .btn-success { background-color: #2ecc71; }
      .btn-danger { background-color: #e74c3c; }
      
    </style>
</head>
<body>

    <div class="dashboard-layout">
        <aside class="sidebar">
            <div class="logo">QuickSEAT</div>
    
            <nav>
              <ul>
                <li><a href="/restaurant-dashboard">Dashboard</a></li>
                <li class="active"><a href="/restaurant-dashboard/menu">Menu</a></li>
                <li><a href="/restaurant-dashboard/floorplan">Floor Plan</a></li>
                <li><a href="/restaurant-dashboard/calendar">Calendar</a></li>
                <li><a href="/restaurant-dashboard/edit">Edit</a></li>
              </ul>
            </nav>
    
            <div class="logout-area">
              <a href="/" class="btn-customer-site">Back to Customer Site</a>
              <a
                href="/logout"
                class="btn-logout"
                onclick="event.preventDefault(); document.getElementById('logout-restaurant-form').submit();"
                >Logout</a
              >
              <form
                id="logout-restaurant-form"
                action="/logout"
                method="GET"
                style="display: none"
              ></form>
            </div>
        </aside>

        <main class="main-content">
            <header class="dashboard-header">
                <h1>Menu Management</h1>
                <div class="user-profile">
                    <div>
                        <strong><%= restaurant.name %></strong>
                        <div style="font-size: 0.8rem; color: #7f8c8d;">Menu Manager</div>
                    </div>
                </div>
            </header>
    
            <% if (locals.success) { %>
                <div class="alert alert-success"><%= locals.success %></div>
            <% } %>
            <% if (locals.error) { %>
                <div class="alert alert-error"><%= locals.error %></div>
            <% } %>
    
            <div class="form-wrapper">
                <h2>Add New Dish</h2>
                <form action="/restaurant-dashboard/menu/add" method="POST" enctype="multipart/form-data">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Cuisine <span class="required">*</span></label>
                            <input type="text" name="cuisine" required>
                        </div>
                        <div class="form-group">
                            <label>Type <span class="required">*</span></label>
                            <select name="type" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 1rem; box-sizing: border-box; background-color: white;">
                                <option value="" disabled selected>Select type</option>
                                <option value="veg">Veg</option>
                                <option value="non-veg">Non-Veg</option>
                                <option value="vegan">Vegan</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Name <span class="required">*</span></label>
                        <input type="text" name="dishName" required>
                    </div>
                    <div class="form-group">
                        <label>Description</label>
                        <textarea name="description" rows="3"></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Price <span class="required">*</span></label>
                            <input type="number" name="price" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label>Image</label>
                            <input type="file" name="image" accept="image/*">
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">Add Dish</button>
                </form>
            </div>
    
            <div class="form-wrapper">
                <h2>Current Menu</h2>
                <div class="stats-grid">
                    <% menus.forEach(dish => { %>
                        <div class="stat-card">
                            <div class="stat-icon" style="background-color: <%= dish.image ? '' : '#667eea' %>">
                                <% if (dish.image) { %>
                                    <img src="<%= dish.image %>" style="width: 100%; height: 100%; object-fit: cover; border-radius: inherit;">
                                <% } else { %>
                                    <%= dish.dishName.charAt(0) %>
                                <% } %>
                            </div>
                            <div class="stat-details">
                                <h3><%= dish.dishName %></h3>
                                <p><%= dish.cuisine %> - <%= dish.type %></p>
                                <p>â‚¹<%= dish.price %></p>
                                <div class="actions">
                                    <a href="#" onclick="toggleAvailability('<%= dish._id %>')" class="btn btn-small btn-<%= dish.isAvailable ? 'danger' : 'success' %>">
                                        <%= dish.isAvailable ? 'Disable' : 'Enable' %>
                                    </a>
                                    <a href="#" onclick="deleteDish('<%= dish._id %>')" class="btn btn-small btn-danger">Delete</a>
                                </div>
                            </div>
                        </div>
                    <% }); %>
                </div>
            </div>
        </main>
    </div>

    <%- include('../includes/footer') %>

    <script>
        async function toggleAvailability(dishId) {
            try {
                await fetch(`/restaurant-dashboard/menu/${dishId}/toggle`, { method: 'PUT' });
                location.reload();
            } catch (err) {
                alert('Error updating status');
            }
        }

        async function deleteDish(dishId) {
            if (confirm('Delete this dish?')) {
                try {
                    await fetch(`/restaurant-dashboard/menu/${dishId}`, { method: 'DELETE' });
                    location.reload();
                } catch (err) {
                    alert('Error deleting dish');
                }
            }
        }
    </script>
</body>
</html>